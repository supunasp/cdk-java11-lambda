
env:
  variables:
    GROUP_ID: "com.novattipayments.cdk"
    ARTIFACT_ID: "cdk-java-11"
    VERSION_ID: "1.0.0"
  exported-variables:
    - GROUP_ID
    - ARTIFACT_ID
    - VERSION_ID

phases:
  install:
    runtime-versions:
      java: corretto11
    commands:
      - export CODEARTIFACT_AUTH_TOKEN=`aws codeartifact get-authorization-token --domain novatti-acquiring --query authorizationToken --output text`
  build:
    commands:
      - export ARTIFACT_ID=$(mvn -s target/settings.xml -f lambda/pom.xml org.apache.maven.plugins:maven-help-plugin:3.2.0:evaluate -Dexpression=project.artifactId -q -DforceStdout)
      - export VERSION_ID=$(mvn -s target/settings.xml -f lambda/pom.xml org.apache.maven.plugins:maven-help-plugin:3.2.0:evaluate -Dexpression=project.version -q -DforceStdout)
      - export GROUP_ID=$(mvn -s target/settings.xml -f lambda/pom.xml org.apache.maven.plugins:maven-help-plugin:3.2.0:evaluate -Dexpression=project.groupId -q -DforceStdout)
      - mvn -s target/settings.xml install deploy:deploy-file -Passembly-zip -Dpackaging=zip -Dfile="lambda/target/${ARTIFACT_ID}-${VERSION_ID}.zip" -DgroupId="${GROUP_ID}" -DartifactId="${ARTIFACT_ID}" -Dversion="${VERSION_ID}" -Durl="https://novatti-acquiring-137671694636.d.codeartifact.ap-southeast-2.amazonaws.com/maven/lib-snapshot-local/" -DrepositoryId=novatti-acquiring--lib-snapshot-local

artifacts:
  files:
    - lambda/target/${ARTIFACT_ID}-${VERSION_ID}.zip


cache:
  paths:
    - '/root/.m2/**/*'